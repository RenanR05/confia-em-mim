<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Você confia em mim?</title>
<style>
  :root{--fg:#fff;--muted:#a3a3a3;--accent:#b388ff}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#000;color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .center{min-height:100%;display:grid;place-items:center;text-align:center;padding:24px}
  .btn{appearance:none;border:0;border-radius:14px;padding:16px 26px;font-weight:800;
       font-size:clamp(16px,4.5vw,22px);color:#1a1a1a;background:var(--accent);cursor:pointer;
       box-shadow:0 10px 30px rgba(179,136,255,.35), inset 0 1px 0 rgba(255,255,255,.4);
       transition:transform .08s ease, filter .2s ease}
  .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(2px) scale(.99)}
  canvas{display:block;position:fixed;inset:0;width:100vw;height:100vh}
</style>
</head>
<body>
<div id="gate" class="center">
  <main>
    <button id="startBtn" class="btn">Você confia em mim?</button>
  </main>
</div>
<script>
/* ===================== CONFIG ===================== */
const AUDIO_URL = "Conga.MP3"; // MP3 local
const BACKGROUND_MODE = "flash";
/* ================================================== */

// util
const Random = {
  float(min,max){ return Math.random()*(max-min)+min; },
  int(min,max){ return Math.floor(Math.random()*(max-min+1))+min; },
  color(){ return '#'+Math.floor(Math.random()*16777215).toString(16).padStart(6,'0'); }
};

// sprite simples
class Sprite{
  constructor(img,frames){ this.img=img; this.frames=frames; }
  static Horizontal(width,height,count){
    const frames=[]; for(let i=0;i<count;i++) frames.push({x:i*width,y:0,w:width,h:height});
    return frames;
  }
  draw(ctx,frame,dx,dy,w,h){
    const f=this.frames[frame]; ctx.drawImage(this.img,f.x,f.y,f.w,f.h,dx|0,dy|0,w||f.w,h||f.h);
  }
}

// cena canvas
class Scene{
  constructor(){
    this.c=document.createElement('canvas');
    this.ctx=this.c.getContext('2d');
    this.entities=[]; this.elapsed=0; this.last=performance.now(); this.protagonist=null;
    this.bg="#000"; this.panel="#000";
    this.resize(); window.addEventListener('resize',()=>this.resize());
    this.ctx.imageSmoothingEnabled=false;
  }
  mount(){ document.body.appendChild(this.c); }
  resize(){
    const dpr = Math.max(1, Math.min(window.devicePixelRatio||1, 2));
    this.c.width = Math.floor(innerWidth*dpr);
    this.c.height= Math.floor(innerHeight*dpr);
    this.c.style.width = innerWidth+"px"; this.c.style.height = innerHeight+"px";
    this.ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  loop=()=>{
    const now=performance.now(), dt=(now-this.last)/1000; this.last=now;
    this.update(dt); this.render(); requestAnimationFrame(this.loop);
  }
  start(){ this.last=performance.now(); this.loop(); }
  update(dt){
    this.elapsed+=dt;
    if(this.elapsed>=.4){
      this.elapsed=0;
      if(BACKGROUND_MODE==='flash'){ this.bg=Random.color(); this.panel=Random.color(); }
      this.entities.push(this.makeEntity());
    }
    if(!this.protagonist){ const p=this.makeEntity(true); p.speed.x=0; p.opacity=1; this.entities.push(p); this.protagonist=p; }
    if(this.protagonist){
      const cw=this.c.clientWidth,ch=this.c.clientHeight, sz=this.protagonist.intrinsic;
      const maxW=Math.min(cw*.8, 600), maxH=Math.min(ch*.8, 600);
      const scale=Math.min(maxW/sz.w, maxH/sz.h);
      const tw=sz.w*scale, th=sz.h*scale;
      this.protagonist.size={w:tw,h:th};
      this.protagonist.pos.x=(cw-tw)/2; this.protagonist.pos.y=(ch-th)/2;
    }
    const off=[];
    for(let i=0;i<this.entities.length;i++){
      const e=this.entities[i]; e.t+=dt;
      if(e.t>=e.frameDur){ e.t=0; e.frame=(e.frame+1) % e.sprite.frames.length; }
      e.pos.x += e.speed.x*dt;
      const cw=this.c.clientWidth; if(e.speed.x!==0 && (e.pos.x>cw || e.pos.x<=-e.size.w)) off.push(i);
    }
    for(let i=off.length-1;i>=0;i--) this.entities.splice(off[i],1);
  }
  render(){
    const {ctx}=this, cw=this.c.clientWidth, ch=this.c.clientHeight;
    ctx.globalAlpha=1; ctx.fillStyle=this.bg; ctx.fillRect(0,0,cw,ch);
    for(const e of this.entities){
      ctx.globalAlpha=e.opacity;
      e.sprite.draw(ctx,e.frame,e.pos.x,e.pos.y,e.size.w,e.size.h);
    }
  }
  makeEntity(protag=false){
    const sp = SPRITES.ditto; const f0 = sp.frames[0];
    const dir = Random.int(0,1); const scale = protag? Random.int(12,18) : Random.int(4,16);
    const opac = protag? 1 : Random.float(.15,1);
    const speedX = protag? 0 : Random.int(400,1000)*(dir?1:-1);
    const cw=this.c.clientWidth, ch=this.c.clientHeight;
    const intrinsic={w:f0.w,h:f0.h}, size={w:intrinsic.w*scale, h:intrinsic.h*scale};
    const origin={x: dir? -size.w : cw, y: Random.int(0, Math.max(0,ch-size.h))};
    return {sprite:sp, frameDur:.085, frame:0, t:0, speed:{x:speedX,y:0}, size, pos:origin, opacity:opac, intrinsic};
  }
}

// carrega sprite
const SPRITES = {};
(function loadSprite(){
  const img=new Image();
  img.onload=()=>{ SPRITES.ditto = new Sprite(img, Sprite.Horizontal(33,29,4)); }
  img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAAAdAgMAAAAWQyy/AAAADFBMVEX///+4YOA4ODj4+PhASPNeAAAAAXRSTlMAQObYZgAAAStJREFUeF6l08FqhEAMBuBhbk6fYyj6Pgmul3pZEN9hWV8i9FgvC3X6PELpe2zP9Y/pyCLLFprLoP83STzo/lv+/ZEoGGwMw10RacmePmML4PfOjyqev6WGKDs/Kth40QiEXInxLPzxle+WHUS8kgoi6vU8zzaobIQB31R4QrU4T9RVKl5ngpheaBP1KlmWLlU4z0iCJioORKxCmzm5nDSJAOx0jxthdEBwzOLIkJyFIEGgQpvVqxSMhVRxQKCiEYhozQtbPV/Fmx6iJE5ErYkWgi8mlOYkEiVZxQRpglUojSZB9wJUTDoxkTeMN4J3ot0JT79CTMifRUmUEtV5803EJcD3+5ScS+MmML+feHBhCcKSWOVvw9s07H+LTdwvL/1Fp9yvaggJUx/WD0e0wREEScedAAAAAElFTkSuQmCC";
})();

// gate → inicia áudio + cena
const btn = document.getElementById('startBtn');
const gate = document.getElementById('gate');

let started=false;
btn.addEventListener('click', ()=>{
  if(started || !SPRITES.ditto) return;
  started = true;

  // inicia cena
  const scene = new Scene();
  scene.mount();
  scene.start();
  gate.remove();

  // toca áudio
  const audio = new Audio(AUDIO_URL);
  audio.loop = true;
  audio.volume = 1.0;
  audio.play().catch(e => console.warn("Autoplay bloqueado:", e));
});
</script>
</body>
</html>
